pico-8 cartridge // http://www.pico-8.com
version 38
__lua__

-- Amulet
-- by Tipa

function _init()
    -- initialize the game
    player = { x=1, y=1 }
    screen_bounds = { x=1, y=1, w=9, h=9 }
    old_button = -1
    save_old_button = -1
end

function _update()
    -- update the game
    -- move player with arrow keys, staying within screen_bounds
    if old_button != -1 then
        save_old_button = old_button
    end
    if btn(⬅️) and old_button != ⬅️ then
        old_button = ⬅️
        player.x = max(player.x - 1, screen_bounds.x)
    elseif btn(➡️) and old_button != ➡️ then
        old_button = ➡️
        player.x = min(player.x + 1, screen_bounds.w)
    elseif btn(⬆️) and old_button != ⬆️ then
        old_button = ⬆️
        player.y = max(player.y - 1, screen_bounds.y)
    elseif btn(⬇️) and old_button != ⬇️ then
        old_button = ⬇️
        player.y = min(player.y + 1, screen_bounds.h)
    else
        old_button = -1
    end
end

function get_terrain_xy(x, y)
    return { 65 - 8 + (x-1) * 7 - 7 * (y-1), 16 + (x-1) * 4 + 4 * (y-1)}
end

function get_character_xy(x, y)
    local coords = get_terrain_xy(x, y)
    coords[2] = coords[2] - 16
    return coords
end

function _draw()
    -- draw the game
    cls()

    print (save_old_button, 0, 0, 7)

    for x=screen_bounds.x, screen_bounds.w do
        for y=screen_bounds.y, screen_bounds.h do
            local coords = get_terrain_xy(x, y)
            spr(0, coords[1], coords[2], 2, 2)
        end
    end

    local coords = get_character_xy(player.x, player.y)

    if save_old_button == ⬇️ then
        spr(4, coords[1], coords[2], 2, 3, true, false)
    elseif save_old_button == ⬅️ then
        spr(6, coords[1], coords[2], 2, 3)
    elseif save_old_button == ⬆️ then
        spr(6, coords[1], coords[2], 2, 3, true, false)
    else
        spr(4, coords[1], coords[2], 2, 3)
    end

end


__gfx__
000000bb000000000000006600000000000001111000000000000011110000000000000000000000000000000000000000000000000000000000000000000000
0000bbbbbb0000000000d6666600000000001dddd1000000000001dddd1000000000000000000000000000000000000000000000000000000000000000000000
00bbbbbbbbbb000000666dd6666600000001dddddd10000000001ddddd1000000000000000000000000000000000000000000000000000000000000000000000
bbbbbbbb3bbbbb00666d666d666d66000001d1dddd1110000011ddddddd100000000000000000000000000000000000000000000000000000000000000000000
33bbb3bbbbbb330066666666dd66660000111dddddd1d11001d1dd1dddd110000000000000000000000000000000000000000000000000000000000000000000
4533bbbbbb335400556666666666110001dd1dddddd1ddd11dd1ddd1ddd1d1000000000000000000000000000000000000000000000000000000000000000000
444533bb33535400555566666611110001ddd111111dddd11ddd11111dd1d1000000000000000000000000000000000000000000000000000000000000000000
44445333555555005555566611111100001ddddddddddd101dddddddd111d1000000000000000000000000000000000000000000000000000000000000000000
4545444354555500555555511111110000011ddddddd1100011ddddddddd10000000000000000000000000000000000000000000000000000000000000000000
44445455554554005555551111111100000111111111d10000011ddddd1110000000000000000000000000000000000000000000000000000000000000000000
544444454555550055555551111111000001d1eeeee1d100001dd11111dd10000000000000000000000000000000000000000000000000000000000000000000
45444445555545005555555111111100001ddd11111d1d1001ddddddddd1d1000000000000000000000000000000000000000000000000000000000000000000
4445444555455500555555511111110001dddddd11dd111001ddddddddd1d1000000000000000000000000000000000000000000000000000000000000000000
0054454545550000005555511111000001dddddddddd1e1001ddddddddd1d1000000000000000000000000000000000000000000000000000000000000000000
000044455500000000005551110000001dd1dd1ddddd1e1001ddd1ddddd1d1000000000000000000000000000000000000000000000000000000000000000000
000000550000000000000011000000001ddd11ddddd1110001ddd1ddd11110000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000001ddd1d11111d10001dddd1111dd100000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000001dd11dddddd100001ddd1ddddd1100000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000011e1ddd1d1e100001dd1dddd11100000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000001ee1dd111eee1001e11ddddddd100000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000011111e111ee1001ee1ddddd1d100000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000001eee101110000111dddd111000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000011ee1000000000001ddd110000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000001110000000000000111000000000000000000000000000000000000000000000000000000000000000000000000
